<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>マスタリングTCP/IP入門編を読んでみた - hachi&#39;s blog</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="マスタリングTCP/IP入門編を読んでみた" />
<meta property="og:description" content="普段の業務はWebアプリケーションの開発がメインなのですが、ネットワーク周りのトラブルが発生した時の原因を調査するための前提知識が足りていないと感じていました。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://m-88888888.github.io/posts/%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0tcpip%E5%85%A5%E9%96%80%E7%B7%A8%E3%82%92%E8%AA%AD%E3%82%93%E3%81%A7%E3%81%BF%E3%81%9F/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-23T00:32:12+09:00" />
<meta property="article:modified_time" content="2021-08-23T00:32:12+09:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="マスタリングTCP/IP入門編を読んでみた"/>
<meta name="twitter:description" content="普段の業務はWebアプリケーションの開発がメインなのですが、ネットワーク周りのトラブルが発生した時の原因を調査するための前提知識が足りていないと感じていました。"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://m-88888888.github.io/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://m-88888888.github.io/css/main.css" /><link rel="stylesheet" type="text/css" href="https://m-88888888.github.io/css/dark.css" media="(prefers-color-scheme: dark)" />

	<script src="https://m-88888888.github.io/js/feather.min.js"></script>
	
	<script src="https://m-88888888.github.io/js/main.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<base href="https://m-88888888.github.io/">
	<h1 class="site-title"><a href="https://m-88888888.github.io/">hachi&#39;s blog</a></h1>
	<div class="site-description"><h2>いろいろアウトプット</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/m-88888888" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/hachi88_10" title="Twitter"><i data-feather="twitter"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">マスタリングTCP/IP入門編を読んでみた</h1>
			<div class="meta">Posted at &mdash; Aug 23, 2021</div>
		</div>

		<div class="markdown">
			<p>普段の業務はWebアプリケーションの開発がメインなのですが、ネットワーク周りのトラブルが発生した時の原因を調査するための前提知識が足りていないと感じていました。</p>
<p>そこで、いつかは読みたいと思っていたネットワークの入門書で有名な<code>マスタリングTCP/IP　入門編　第6版</code>を読んでみました。</p>
<p><img src="https://user-images.githubusercontent.com/51853475/130361395-1ea8f6ee-fb0b-4326-8aa9-775bd1fccab4.jpg" alt="2000007974462"></p>
<h2 id="読書ノート">読書ノート</h2>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-md" data-lang="md"><span style="color:#cb4b16"># 1章　ネットワーク基礎知識
</span><span style="color:#cb4b16"></span><span style="color:#719e07">-</span> コンピュータ間通信からコンピュータネットワーク、インターネットへと情報通信ネットワークが形成されていった
<span style="color:#719e07">-</span> コンピュータ間の通信の決まりごととして「プロトコル」がISOによって「OSI参照モデル」が定められた
<span style="color:#719e07">-</span> これに準拠することで異なるコンピュータのハードウェアやOSの違いを気にせず通信できるようになった
<span style="color:#719e07">-</span> OSI参照モデルは機能を7つの階層に分割することで、複雑になりがちなネットワーク・プロトコルを単純化させた
<span style="color:#719e07">-</span> 上位層→下位層の間のやり取りの決まりごとを「インタフェース」と呼ぶ
<span style="color:#719e07">-</span> 通信相手と同じ階層とのやり取りの決まりごとを「プロトコル」と呼ぶ
<span style="color:#719e07">-</span> OSI参照モデルの各層の役割と機能イメージ
    <span style="color:#719e07">-</span> 物理層：0/1のビットを電圧の高低、光の点滅に変換
    <span style="color:#719e07">-</span> データリンク層：データフレームとビット列の変換。ネットワーク層は最終目的地までのデータ配達を、データリンク層は1区間のデータ配達を担う。
    <span style="color:#719e07">-</span> ネットワーク層：アドレスの管理と経路の選択。実際にデータを配達する役割
    <span style="color:#719e07">-</span> トランスポート層：ノード間のデータ転送の管理。ホスト間の論理的な通信手段の作成。
    <span style="color:#719e07">-</span> セッション層：コネクションの確立などの管理
    <span style="color:#719e07">-</span> プレゼンテーション層：ソフトウェア上の形式のデータをネットワーク共通のデータフォーマットに相互変換
    <span style="color:#719e07">-</span> アプリケーション層：アプリケーションごとのプロトコル。処理全体の最初と最後の部分を実行
<span style="color:#719e07">-</span> 通信方式の種類と用途
    <span style="color:#719e07">-</span> コネクション型：送信側、受信側双方のホスト間で確立してからデータ送信する
    <span style="color:#719e07">-</span> コネクションレス型：受信側の都合を考慮せず一方的にデータを送信する
        <span style="color:#719e07">-</span> 確立せず送信できるので、通信速度向上・電波状況が悪いときなどの低品質の通信の継続などに使われる
<span style="color:#719e07">-</span> コンピュータ→交換器→コンピュータという流れで回線を接続していた回線交換方式は、コネクションを確立した回線を占有してしまう。そこで、データをパケットとして細分化して各コンピュータが一斉に送受信できるようになった（パケット交換）
    <span style="color:#719e07">-</span> パケット交換器＝ルーター。
    <span style="color:#719e07">-</span> 回線を占有する方法から、データを分割して回線を共有する方法に変えた。
    <span style="color:#719e07">-</span> パケット交換の場合、通常コンピュータ→ルーター間は回線が1つだけなので、この回線を共有することになる。そうするとネットワークの混雑度によってパケットの到着間隔が前後したり、ルーターのバッファ（パケットを一旦格納する場所）があふれるとパケットが喪失する恐れがある。「インターネット速度が遅い」と言われる減少はこのこと？
<span style="color:#719e07">-</span> IPアドレスにも現実の住所などと同じように「階層性」が必要
    <span style="color:#719e07">-</span> ネットワーク部・ホスト部という階層を持つ
    <span style="color:#719e07">-</span> ※MACアドレスには階層性はない

<span style="color:#cb4b16"># 2章　TCP/IP基礎知識
</span><span style="color:#cb4b16"></span><span style="color:#719e07">-</span> TCP/IPの階層（OSI参照モデルの階層）
    <span style="color:#719e07">-</span> ハードウェア（物理層）：物理回線のこと。利用できる通信媒体に制限はない
    <span style="color:#719e07">-</span> ネットワークインタフェース層（データリンク層）：デバイスドライバのこと
    <span style="color:#719e07">-</span> インターネット層（ネットワーク層）：IPのこと。IPはIPアドレスを識別子として使ってネットワークをまたいでパケットを送信するプロトコル。
        <span style="color:#719e07">-</span> IPはパケットが相手に到達しなくても再送しない
        <span style="color:#719e07">-</span> ICMPは相手に到達しない場合、送信元に異常を知らせてくれる。ネットワーク診断などに使われる
        <span style="color:#719e07">-</span> ARP：IPアドレスから送り先の物理的なアドレス（MACアドレス）を取得するプロトコル
    <span style="color:#719e07">-</span> トランスポート層（トランスポート層）：ポート番号を使ってアプリケーションプログラム間の通信を実現するための階層。
        <span style="color:#719e07">-</span> TCP：コネクション型。
        <span style="color:#719e07">-</span> UDP：コネクションレス型。音声・映像データなどの場合に利用される
    <span style="color:#719e07">-</span> アプリケーション層（セッション層↑の上位層）：セッション〜プレゼンテーション〜アプリケーション層はすべてアプリケーションプログラムの中で実現される。
<span style="color:#719e07">-</span> 通信の流れ：各層で送信されるデータにヘッダを付加していき、受信側が同じ層でヘッダを解釈していく。
    <span style="color:#719e07">-</span> 電子メールの例。p212の図がわかりやすい
    <span style="color:#719e07">-</span> パケットの構造イメージ。p215がわかりやすい
        <span style="color:#719e07">-</span> 各層でMACアドレス・IPアドレス・ポート番号の送信元・送信先をヘッダに付加しているイメージ。
        <span style="color:#719e07">-</span> データが壊れていないことも確認している。

<span style="color:#cb4b16"># 3章　データリンク
</span><span style="color:#cb4b16"></span><span style="color:#719e07">-</span> データリンク層の技術を使った通信媒体についての紹介
<span style="color:#719e07">-</span> 今の所あんまり興味ないので、さらっと目を通してスキップ

<span style="color:#cb4b16"># 4章　IP
</span><span style="color:#cb4b16"></span><span style="color:#719e07">-</span> 「IP」というプロトコルが、IPアドレス、IPパケットなど色んな言葉に使われていて「IP」単体だと誤解されがちなので、「the IP protocol」、「IPプロトコル」と表現されるケースがある
<span style="color:#719e07">-</span> ネットワーク層とデータリンク層の関係は、旅の行程表と航空券や切符の関係性に似ている
    <span style="color:#719e07">-</span> ネットワーク層は最終目的地までの通信、つまり旅の最終目的地。そこまでの通信（旅行）を実現する
    <span style="color:#719e07">-</span> データリンク層は通信の1区間の通信、旅行で移動する時に飛行機を使って羽田空港〜新千歳空港までの航空券に該当する。つまり、最終目的地までの通信の1単位。
<span style="color:#719e07">-</span> IPアドレスは、データリンクの性質を抽象化しているので、同じIPアドレスでネットワークの運用管理をできるようにする役割を持っている
<span style="color:#719e07">-</span> ルーティングは、ホストorルーターがIPパケットをどこに転送するのかを指示する。転送先は最終目的地を直接指示しているわけではなく、ネットワークの各区間ごとに個々のルーターが持つルーティングテーブルと呼ばれる転送先の表を見て、転送先を決めている。この作業を繰り返すことで最終的な目的地まで通信できている。
<span style="color:#719e07">-</span> IPはデータリンクの性質を抽象化するので、通信形式が無線LAN or 有線LANなど、一度に送信できる通信量に差が生じる場合に、一度に送信しきれないIPパケットを分割処理（フラグメンテーション）を行う必要がある。
<span style="color:#719e07">-</span> IPは機能の簡略化・高速化のためにコネクションレス型。コネクション型が必要な場合はIPよい上位の層で対応すれば良い
<span style="color:#719e07">-</span> IPアドレスのネットワーク部・ホスト部の切れ目をサブネットマスクを使って判断できるようにした
    <span style="color:#719e07">-</span> サブネットマスクのビットが「１」の部分がネットワーク部、「０」の部分がホスト部
<span style="color:#719e07">-</span> ネットワーク部・ホスト部の桁数が決められたクラスではなく、自分たちで任意の桁数に変更するための仕組みが「CIDR」

<span style="color:#cb4b16"># 5章　IPに関する技術
</span><span style="color:#cb4b16"></span><span style="color:#719e07">-</span> ARPANET時代は、**hosts**というホスト名とIPアドレスの対応を定義したデータベースファイルが利用されていた。hostsの中身は携帯電話の連絡先みたいなもの。ホスト名が相手の名前、IPアドレスが電話番号
<span style="color:#719e07">-</span> hostsを一括管理していたが、ネットワークの規模が大きくなるにつれ管理が難しくなった
<span style="color:#719e07">-</span> ホスト管理している組織の単位でhostsみたいなデータベースを管理するための手段が**DNS**
    <span style="color:#719e07">-</span> ホスト名、IPアドレスの変更がある度にhostsを管理する機関に報告や申請する必要がなくなった。
    <span style="color:#719e07">-</span> ダイナミックDNS・・・IPアドレスが変化しても同じホスト名を利用できる
<span style="color:#719e07">-</span> ドメイン名の構造はツリー構造になっている　P439
    <span style="color:#719e07">-</span> 例：kusa.ac.jp
        <span style="color:#719e07">-</span> kusa・・・
        <span style="color:#719e07">-</span> ac・・・分野別トップレベルドメイン（gTLD）
        <span style="color:#719e07">-</span> jp・・・国コードトップレベルドメイン（ccTLD）
<span style="color:#719e07">-</span> ネームサーバー：上記のドメイン構造の各階層で設置されており、自分の階層のドメイン名を管理しているホスト・ソフトウェアのこと
    <span style="color:#719e07">-</span> ネームサーバーは下の階層のIPアドレス、ルートネームサーバーのIPアドレスを知っているので、ルートから順番にたどることで世界中のネームサーバーにアクセスできる
<span style="color:#719e07">-</span> リゾルバ（Resolver）：DNSに問い合わせするホスト・ソフトウェアのこと。ユーザーの利用するPCがリゾルバに該当する。
<span style="color:#719e07">-</span> DNS問い合わせの処理（query）　P445
    <span style="color:#719e07">-</span> ルートネームサーバーに対象ホストの所属するネームサーバーのIPアドレスを聞きに行く
    <span style="color:#719e07">-</span> 木構造の上から順番にたどる
<span style="color:#719e07">-</span> DNSはホスト名→IPアドレスを検索するだけではなく、ホスト名→IPアドレス、上位・下位のネームサーバーのIPアドレスなどの情報も保持している。　P447
<span style="color:#719e07">-</span> ARP：IPで宛先IPアドレスにデータリンクを使って通信するときにはMACアドレスも必要。このMACアドレスをIPアドレスから知りたい時に使われるプロトコル。
    <span style="color:#719e07">-</span> ARPはIPv4でのみ利用
    <span style="color:#719e07">-</span> IPv6はARPの代わりにICMPv6を利用
<span style="color:#719e07">-</span> ARPの仕組み　P449
    <span style="color:#719e07">-</span> ホストAがホストBのMACアドレスを知りたい
        <span style="color:#719e07">-</span> ホストAがARP要求パケットというパケットで、ホストBのIPアドレスをブロードキャスト（同一リンクのすべてのホストに通信）する
        <span style="color:#719e07">-</span> ブロードキャストされたパケットをすべてのホストが受取る
        <span style="color:#719e07">-</span> すべてのホストがARP要求パケットの中の目的のIPアドレスが自分のIPアドレスに一致する
        <span style="color:#719e07">-</span> 自分のMACアドレスを埋めたARP応答パケットをホストA宛に返送する
        <span style="color:#719e07">-</span> 一度取得したMACアドレスは数分間キャッシュされる

        ```sh
        $ apa
        Address                  HWtype  HWaddress           Flags Mask            Iface
        192.168.11.26            ether   16:53:4c:ba:9c:89   C                     wlp1s0
        _gateway                 ether   18:ec:e7:6d:b2:78   C                     wlp1s0
        192.168.11.5             ether   dc:91:bf:03:cf:19   C                     wlp1s0
        ```

<span style="color:#719e07">-</span> ネットワークの通信の最終目的地はMACアドレスなので、MACアドレスだけわかれば通信できるのでは？
    <span style="color:#719e07">-</span> IPアドレスがないとどうなるかを考えてみる
        <span style="color:#719e07">-</span> インターネットはネットワークが複数絡み合うことで構築されている。このネットワークの始端を各ネットワークのホストを管理しているルーターが担っている。
        <span style="color:#719e07">-</span> 異なるネットワークのホストのMACアドレスだけを知っても、そのホストがどのネットワークにいるのかがわからない。
        <span style="color:#719e07">-</span> ネットワークを特定するために、各ネットワークのルーターが「次のルーター」を知る役割を持っている
        <span style="color:#719e07">-</span> なので、IPアドレスが宛先ホストの存在するネットワークを特定するために必要不可欠
<span style="color:#719e07">-</span> RARP：ARPの逆。MACアドレスからIPアドレスを知りたい場合に使う
<span style="color:#719e07">-</span> GARP：自分のIPアドレスに対するMACアドレスを知りたい場合に使う。IPアドレスの重複の確認に使われる
<span style="color:#719e07">-</span> Proxy ARP：本来の問い合わせ先に代わってARP応答する機能
<span style="color:#719e07">-</span> ICMP：IPパケットが目的地まで到達したかどうかを通知してくれる
    <span style="color:#719e07">-</span> ICMPv6：IPv4のARPの代わりにICMPを使ってIPアドレス→MACアドレスを調べる
<span style="color:#719e07">-</span> DHCP：コンピュータをネットワークに接続するだけでTCP/IP通信ができるようになるための仕組み。プラグ＆プレイが実現される。
    <span style="color:#719e07">-</span> 本来、TCP/IP通信のためにはホストごとにIPアドレスを設定する必要がある。その設定を自動化してくれる役割を持つ。
<span style="color:#719e07">-</span> NAT（Network Address Translator）：ローカルネットワークのプライベートIPアドレスとインターネットへ接続するときに使うグローバルIPアドレスを変換する技術。

<span style="color:#cb4b16"># 6章　TCPとUDP
</span><span style="color:#cb4b16"></span><span style="color:#719e07">-</span> トランスポートプロトコルの代表的なものがTCPとUDP
    <span style="color:#719e07">-</span> TCP：信頼性のある通信。コネクション型。ストリーム型。ふくそう制御。再送機能。
    <span style="color:#719e07">-</span> UDP：同報通信（マルチキャスト、ブロードキャストのこと）。コネクションレス型。
<span style="color:#719e07">-</span> IPヘッダにはプロトコルフィールド、どのトランスポートプロトコルにデータを渡すかが定義されている。これと同様にトランスポート層のTCP・UDPでも次にどのアプリケーションにデータを渡すかが定義されている。これが**ポート番号**
    <span style="color:#719e07">-</span> ポート番号はプログラムのアドレス、とも言える
<span style="color:#719e07">-</span> トランスポート層は、データを渡すプログラムを指定する役割を持つ
<span style="color:#719e07">-</span> デーモン（Daemon）：常時起動されていて特定の処理を実行するプログラムのこと
    <span style="color:#719e07">-</span> httpd（HTTPデーモン）：HTTPのサーバープログラム
    <span style="color:#719e07">-</span> sshd（sshデーモン）：sshのサーバープログラム
    <span style="color:#719e07">-</span> inetd（インターネットデーモン）：複数のデーモンの代表としてクライアントの要求を受け付けるスーパーデーモン。要求を受けるとsshdなどのデーモンに返信する
<span style="color:#719e07">-</span> TCPとUDPの使い分け
    <span style="color:#719e07">-</span> 人と人が対話するIP電話の場合
        <span style="color:#719e07">-</span> TCPはデータがロスしたら再送処理を行うので、音声の再生がスムーズにいかない
        <span style="color:#719e07">-</span> UDPは多少データをロスしても再送処理をしないので、音声が遅れて届く。みたいなことはない。多少パケットがロスしても一時的に音声が乱れるだけ。
    <span style="color:#719e07">-</span> UDPはふくそう制御がないので、インターネットでの高品質な通信が難しい
<span style="color:#719e07">-</span> ソケット：OSが持っているTCP/IPの機能をAPIとして提供してくれる
<span style="color:#719e07">-</span> TCP,UDPそれぞれ同じポート番号を使うことができる。なぜならポート番号の処理がトランスポートプロトコルごとに行われるから。
<span style="color:#719e07">-</span> UDP（User Datagram Protocol）
    <span style="color:#719e07">-</span> アプリケーション側に通信制御を任せるため、複雑な制御をせずに通信できる
    <span style="color:#719e07">-</span> プログラマーの思い通りにプログラミングできるデータグラムプロトコル
    <span style="color:#719e07">-</span> その分、プログラマーが上位層のプロトコルを考慮してアプリケーションを作成する必要がある
<span style="color:#719e07">-</span> TCP（Transmission Control Protocol）
    <span style="color:#719e07">-</span> ふくそう制御とか、通信の信頼性を高めるための仕組みが多い感じ。全部は読みきれてない
<span style="color:#719e07">-</span> QUIC
    <span style="color:#719e07">-</span> HTTP/3の基盤となる新たなトランスポートプロトコル
    <span style="color:#719e07">-</span> UDPと合わせて1つのトランスポートプロトコルとしての役割を提供する
    <span style="color:#719e07">-</span> TCP自体には暗号化の機能はなかったが、QUICはそれ自体で暗号通信ができる

<span style="color:#268bd2">## 気になったこと
</span><span style="color:#268bd2"></span>
<span style="color:#719e07">-</span> ポート番号って上限とかあるの？ダイナミックな割当法だと49152〜65535までの整数が利用される。っていっているけど、10000000000000みたいなポート番号も使えたりするの？
    <span style="color:#719e07">-</span> TCPのポート番号が16ビットだから、上限が65535

<span style="color:#cb4b16"># 7章　ルーティングプロトコル
</span><span style="color:#cb4b16"></span><span style="color:#719e07">-</span> 流し読み

<span style="color:#cb4b16"># 8章　アプリケーションプロトコル
</span><span style="color:#cb4b16"></span><span style="color:#719e07">-</span> 流し読み

<span style="color:#cb4b16"># 9章　セキュリティ
</span><span style="color:#cb4b16"></span><span style="color:#719e07">-</span> 流し読み

</code></pre></div><h2 id="感想">感想</h2>
<ul>
<li>1章、2章、4章、5章、6章あたりが特に勉強になった。</li>
<li>TCP/IPの階層とその役割を理解する上で、OSI参照モデルがベースになっているので非常にイメージがしやすい。</li>
<li>TCP、UDPとかプロトコルが存在していることは知っていたが、それらがなぜ必要でどのように使われているのかを理解したことで、TCP/IPの通信の動きが少しわかってきた気がする</li>
<li>7〜9章はあんまりメモ取らずに読んでしまったのでまた今度見返したい</li>
<li>ソケットプログラミングちょっと興味ある。golangでTCPクライアント作って3-way-handshakeの動きを確認してみるのも良さそう</li>
<li>アプリケーション層のプロトコルであるhttpを支えるプロトコルの動きがおおまかだけど理解できたので、次はhttpそのもののプロトコルをもう一歩深堀りしていきたい</li>
</ul>

		</div>

		<div class="post-tags">
			
				
			
		</div>
		<div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'localhost';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
		Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © Copyright m-88888888 |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-192108063-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>feather.replace()</script>
</body>
</html>
